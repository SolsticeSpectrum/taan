import { Button, VerticalBox, HorizontalBox, ScrollView, Palette, StyleMetrics } from "std-widgets.slint";

component FilterChip inherits Rectangle {
    in property <string> text;
    in property <bool> active: false;
    callback clicked();
    height: 32px;
    width: chip-text.preferred-width + 24px;
    background: root.active ? Palette.accent-background : (touch-area.has-hover ? Palette.control-background : Palette.control-background.with-alpha(0.5));
    border-radius: 16px;
    border-width: 1px;
    border-color: root.active ? Palette.accent-background : Palette.border;
    chip-text := Text {
        text: root.text;
        color: root.active ? Palette.accent-foreground : Palette.foreground;
        font-size: 14px;
        font-weight: root.active ? 600 : 400;
        horizontal-alignment: center;
        vertical-alignment: center;
        x: (parent.width - self.width) / 2;
        y: (parent.height - self.height) / 2;
    }

    touch-area := TouchArea {
        clicked => {
            root.clicked();
        }
    }
}

component SearchResultCard inherits Rectangle {
    in property <string> title;
    in property <string> subtitle;
    in property <string> type; // "track", "artist", "album", "playlist"
    in property <bool> is-playing: false;
    callback clicked();
    callback play-clicked();
    height: 64px;
    background: touch-area.has-hover ? Palette.control-background.with-alpha(0.1) : transparent;
    border-radius: 4px;
    HorizontalBox {
        padding: 8px;
        alignment: space-between;
        HorizontalBox {
            alignment: start;
            spacing: 12px;
            
            // Cover/Icon
            Rectangle {
                width: 48px;
                height: 48px;
                background: root.type == "track" ? #1db954 : (root.type == "artist" ? #ff6b6b : (root.type == "album" ? #4ecdc4 : #45b7d1));
                border-radius: root.type == "artist" ? 24px : 4px;
                Text {
                    text: root.type == "track" ? "♪" : (root.type == "artist" ? "👤" : (root.type == "album" ? "💿" : "📋"));
                    color: white;
                    font-size: 20px;
                    horizontal-alignment: center;
                    vertical-alignment: center;
                }
            }
            
            // Info
            VerticalBox {
                alignment: center;
                spacing: 4px;
                horizontal-stretch: 1;
                Text {
                    text: root.title;
                    color: Palette.foreground;
                    font-size: 16px;
                    font-weight: 500;
                    overflow: elide;
                    horizontal-alignment: left;
                }

                HorizontalBox {
                    alignment: start;
                    spacing: 8px;
                    Rectangle {
                        width: type-label.preferred-width + 8px;
                        height: 18px;
                        background: Palette.foreground.with-alpha(0.1);
                        border-radius: 9px;
                        type-label := Text {
                            text: root.type.to-uppercase();
                            color: Palette.foreground.with-alpha(0.8);
                            font-size: 10px;
                            font-weight: 600;
                            horizontal-alignment: center;
                            vertical-alignment: center;
                        }
                    }

                    Text {
                        text: root.subtitle;
                        color: Palette.foreground.with-alpha(0.7);
                        font-size: 14px;
                        overflow: elide;
                        vertical-alignment: center;
                    }
                }
            }
        }
        
        // Play button
        if (root.type == "track" || root.type == "album" || root.type == "playlist") && (touch-area.has-hover || root.is-playing): Rectangle {
            width: 32px;
            height: 32px;
            background: root.is-playing ? Palette.accent-background : (play-touch.has-hover ? Palette.accent-background.with-alpha(0.8) : Palette.accent-background);
            border-radius: 16px;
            Text {
                text: root.is-playing ? "⏸" : "▶";
                color: Palette.accent-foreground;
                font-size: 12px;
                horizontal-alignment: center;
                vertical-alignment: center;
            }

            play-touch := TouchArea {
                clicked => {
                    root.play-clicked();
                }
            }
        }
    }

    touch-area := TouchArea {
        clicked => {
            root.clicked();
        }
    }
}

export component SearchInterface inherits Rectangle {
    in property <string> search-query;
    in-out property <string> active-filter: "All";
    callback filter-changed(string);
    callback result-clicked(string, string); // type, title
    callback play-clicked(string, string); // type, title
    
    background: Palette.background;
    VerticalBox {
        spacing: 24px;
        padding: StyleMetrics.layout-padding * 2;
        
        // Search filters
        HorizontalBox {
            alignment: start;
            spacing: 12px;
            FilterChip {
                text: "All";
                active: root.active-filter == "All";
                clicked => {
                    root.active-filter = "All";
                    root.filter-changed("All");
                }
            }

            FilterChip {
                text: "Songs";
                active: root.active-filter == "Songs";
                clicked => {
                    root.active-filter = "Songs";
                    root.filter-changed("Songs");
                }
            }

            FilterChip {
                text: "Artists";
                active: root.active-filter == "Artists";
                clicked => {
                    root.active-filter = "Artists";
                    root.filter-changed("Artists");
                }
            }

            FilterChip {
                text: "Albums";
                active: root.active-filter == "Albums";
                clicked => {
                    root.active-filter = "Albums";
                    root.filter-changed("Albums");
                }
            }

            FilterChip {
                text: "Playlists";
                active: root.active-filter == "Playlists";
                clicked => {
                    root.active-filter = "Playlists";
                    root.filter-changed("Playlists");
                }
            }

            FilterChip {
                text: "Podcasts";
                active: root.active-filter == "Podcasts";
                clicked => {
                    root.active-filter = "Podcasts";
                    root.filter-changed("Podcasts");
                }
            }
        }
        
        // Search results
        if root.search-query != "": VerticalBox {
            spacing: 16px;
            
            // Top result section
            if root.active-filter == "All": VerticalBox {
                spacing: 12px;
                Text {
                    text: "Top result";
                    color: Palette.foreground;
                    font-size: 20px;
                    font-weight: 700;
                }

                Rectangle {
                    height: 120px;
                    background: Palette.control-background.with-alpha(0.1);
                    border-radius: 8px;
                    HorizontalBox {
                        padding: 20px;
                        alignment: start;
                        spacing: 16px;
                        Rectangle {
                            width: 80px;
                            height: 80px;
                            background: #ff6b6b;
                            border-radius: 40px;
                            Text {
                                text: "👤";
                                color: white;
                                font-size: 32px;
                                horizontal-alignment: center;
                                vertical-alignment: center;
                            }
                        }

                        VerticalBox {
                            alignment: start;
                            spacing: 8px;
                            Text {
                                text: "Artist Name";
                                color: Palette.foreground;
                                font-size: 24px;
                                font-weight: 700;
                            }

                            Rectangle {
                                width: artist-label.preferred-width + 12px;
                                height: 24px;
                                background: Palette.foreground.with-alpha(0.1);
                                border-radius: 12px;
                                artist-label := Text {
                                    text: "ARTIST";
                                    color: Palette.foreground.with-alpha(0.8);
                                    font-size: 12px;
                                    font-weight: 600;
                                    horizontal-alignment: center;
                                    vertical-alignment: center;
                                }
                            }
                        }
                    }
                }
            }
            
            // Results list
            VerticalBox {
                spacing: 12px;
                Text {
                    text: root.active-filter == "All" ? "Songs" : root.active-filter;
                    color: Palette.foreground;
                    font-size: 20px;
                    font-weight: 700;
                }

                ScrollView {
                    VerticalBox {
                        spacing: 4px;
                        SearchResultCard {
                            title: "Blinding Lights";
                            subtitle: "The Weeknd • After Hours";
                            type: "track";
                            clicked => {
                                root.result-clicked("track", "Blinding Lights");
                            }
                            play-clicked => {
                                root.play-clicked("track", "Blinding Lights");
                            }
                        }

                        SearchResultCard {
                            title: "Save Your Tears";
                            subtitle: "The Weeknd • After Hours";
                            type: "track";
                            is-playing: true;
                            clicked => {
                                root.result-clicked("track", "Save Your Tears");
                            }
                            play-clicked => {
                                root.play-clicked("track", "Save Your Tears");
                            }
                        }

                        SearchResultCard {
                            title: "The Weeknd";
                            subtitle: "Artist • 82.4M monthly listeners";
                            type: "artist";
                            clicked => {
                                root.result-clicked("artist", "The Weeknd");
                            }
                            play-clicked => {
                                root.play-clicked("artist", "The Weeknd");
                            }
                        }

                        SearchResultCard {
                            title: "After Hours";
                            subtitle: "The Weeknd • 2020";
                            type: "album";
                            clicked => {
                                root.result-clicked("album", "After Hours");
                            }
                            play-clicked => {
                                root.play-clicked("album", "After Hours");
                            }
                        }

                        SearchResultCard {
                            title: "Synthwave Essentials";
                            subtitle: "Spotify • 142,532 likes";
                            type: "playlist";
                            clicked => {
                                root.result-clicked("playlist", "Synthwave Essentials");
                            }
                            play-clicked => {
                                root.play-clicked("playlist", "Synthwave Essentials");
                            }
                        }

                        SearchResultCard {
                            title: "Can't Feel My Face";
                            subtitle: "The Weeknd • Beauty Behind the Madness";
                            type: "track";
                            clicked => {
                                root.result-clicked("track", "Can't Feel My Face");
                            }
                            play-clicked => {
                                root.play-clicked("track", "Can't Feel My Face");
                            }
                        }
                    }
                }
            }
        }
        
        // Browse categories (when no search)
        if root.search-query == "": VerticalBox {
            spacing: 24px;
            Text {
                text: "Browse all";
                color: Palette.foreground;
                font-size: 24px;
                font-weight: 700;
            }
            
            // Category grid
            VerticalBox {
                spacing: 16px;
                HorizontalBox {
                    spacing: 16px;
                    alignment: start;
                    Rectangle {
                        width: 180px;
                        height: 120px;
                        background: #ff6b6b;
                        border-radius: 8px;
                        VerticalBox {
                            padding: 16px;
                            alignment: space-between;
                            Text {
                                text: "Pop";
                                color: white;
                                font-size: 18px;
                                font-weight: 700;
                                horizontal-alignment: left;
                            }

                            HorizontalBox {
                                alignment: end;
                                Text {
                                    text: "🎤";
                                    color: white;
                                    font-size: 32px;
                                }
                            }
                        }
                    }

                    Rectangle {
                        width: 180px;
                        height: 120px;
                        background: #4ecdc4;
                        border-radius: 8px;
                        VerticalBox {
                            padding: 16px;
                            alignment: space-between;
                            Text {
                                text: "Hip-Hop";
                                color: white;
                                font-size: 18px;
                                font-weight: 700;
                                horizontal-alignment: left;
                            }

                            HorizontalBox {
                                alignment: end;
                                Text {
                                    text: "🎵";
                                    color: white;
                                    font-size: 32px;
                                }
                            }
                        }
                    }

                    Rectangle {
                        width: 180px;
                        height: 120px;
                        background: #6c5ce7;
                        border-radius: 8px;
                        VerticalBox {
                            padding: 16px;
                            alignment: space-between;
                            Text {
                                text: "Rock";
                                color: white;
                                font-size: 18px;
                                font-weight: 700;
                                horizontal-alignment: left;
                            }

                            HorizontalBox {
                                alignment: end;
                                Text {
                                    text: "🎸";
                                    color: white;
                                    font-size: 32px;
                                }
                            }
                        }
                    }

                    Rectangle {
                        width: 180px;
                        height: 120px;
                        background: #fd79a8;
                        border-radius: 8px;
                        VerticalBox {
                            padding: 16px;
                            alignment: space-between;
                            Text {
                                text: "Electronic";
                                color: white;
                                font-size: 18px;
                                font-weight: 700;
                                horizontal-alignment: left;
                            }

                            HorizontalBox {
                                alignment: end;
                                Text {
                                    text: "🎧";
                                    color: white;
                                    font-size: 32px;
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}
